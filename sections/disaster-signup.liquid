<div
  class="disaster-signup"
  id="disaster-signup"
  x-data="
    {
     submitted: false,
     checkAndUpdateIfSuccess() {
       var target = document.querySelector('#mce-success-response');

       var observer = new MutationObserver(() => {
         this.submitted = true
         console.log('submitted', this.submitted)
       });

       // configuration of the observer:
       var config = {
         childList: true
       };

       // pass in the target node, as well as the observer options
       observer.observe(target, config);
     }
    }
  "
  x-init="checkAndUpdateIfSuccess()"
>
  <div class="xmas-promo-line-form" x-show="!submitted">
    <!-- Begin Mailchimp Signup Form -->
    <div id="mc_embed_signup" style="width: 100%;">
      <form
        action="https://ecoflow.us19.list-manage.com/subscribe/post?u=80218c17c3ffb8d06454fa749&amp;id=52ba651ae0&amp;f_id=00f292e4f0"
        method="post"
        id="mc-embedded-subscribe-form"
        name="mc-embedded-subscribe-form"
        class="validate"
        target="_blank"
        novalidate
      >
        <div id="mc_embed_signup_scroll">
          <div class="mc-field-group">
            <!--
              <label for="mce-EMAIL"
                >メールアドレス <span class="asterisk">*</span>
              </label>
            -->
            <input
              type="email"
              value=""
              name="EMAIL"
              class="required email"
              id="mce-EMAIL"
              placeholder="Email address"
              required
            >
            <span id="mce-EMAIL-HELPERTEXT" class="helper_text"></span>
          </div>
          <div id="mce-responses" class="clear">
            <div
              class="response"
              id="mce-error-response"
              style="display:none"
            ></div>
            <div
              class="response"
              id="mce-success-response"
              style="display:none"
            ></div>
          </div>
          <!--
            real people should not fill this in and expect good things - do not remove this or risk form bot signups
          -->
          <div style="position: absolute; left: -5000px;" aria-hidden="true">
            <input
              type="text"
              name="b_80218c17c3ffb8d06454fa749_52ba651ae0"
              tabindex="-1"
              value=""
            >
          </div>
          <div class="clear">
            <input
              type="submit"
              value="{{ section.settings.btn_text }}"
              name="subscribe"
              id="mc-embedded-subscribe"
              class="button"
            >
          </div>
        </div>
      </form>
    </div>

    <!-- End mc_embed_signup -->
  </div>

  <script type="text/javascript">
    document.addEventListener('alpine:init', function () {
      const mcValidateScript = document.createElement('script');
      mcValidateScript.id = 'mc-validate-script';
      mcValidateScript.src =
        '//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js';

      mcValidateScript.addEventListener('load', function () {
        (function ($) {
          window.fnames = new Array();
          window.ftypes = new Array();
          fnames[0] = 'EMAIL';
          ftypes[0] = 'email';
          fnames[1] = 'FNAME';
          ftypes[1] = 'text';
          fnames[2] = 'LNAME';
          ftypes[2] = 'text';
          fnames[3] = 'ADDRESS';
          ftypes[3] = 'address';
          fnames[4] = 'PHONE';
          ftypes[4] = 'phone';
        })(jQuery);
        var $mcj = jQuery.noConflict(true);
      });

      document.head.appendChild(mcValidateScript);
    });
  </script>

  <div class="disaster-signup-thankyou" x-show="submitted">
    <h2>Thank You</h2>
    <div>{{ section.settings.thankyou }}</div>
  </div>

  <div class="disaster-signup-blue-text" x-show="!submitted">
    {{ section.settings.text }}
  </div>
  <div class="disaster-signup-richtext" x-show="!submitted">
    {{ section.settings.richtext }}
  </div>
</div>

{% schema %}
{
  "name": "Lucky bag email signup",
  "settings": [
    {
      "type": "text",
      "id": "btn_text",
      "label": "Button text",
      "default": "Get List"
    },
    {
      "type": "text",
      "id": "text",
      "label": "Blue text",
      "default": "Complete to download the power outage emergency checklist now"
    },
    {
      "type": "richtext",
      "id": "richtext",
      "label": "RichText"
    },
    {
      "type": "header",
      "content": "Thanks you"
    },
    {
      "type": "richtext",
      "id": "thankyou",
      "label": "Thank you richtext"
    }
  ]
}
{% endschema %}
